<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="activetech.edpc.dao.mapper.HspDbzlBasMapperCustom">
    <sql id="condition">
        <if test="hspDbzlBasCustom!=null">
            <if test="hspDbzlBasCustom.hspAra!=null and hspDbzlBasCustom.hspAra!=''.toString()">
                and a.hsp_ara =#{hspDbzlBasCustom.hspAra,jdbcType=VARCHAR}
            </if>
            <if test="hspDbzlBasCustom.regSeq != null and hspDbzlBasCustom.regSeq != ''.toString() ">
                and (a.reg_seq like '%' || #{hspDbzlBasCustom.regSeq,jdbcType=VARCHAR} || '%'
                or a.cst_nam like '%' || #{hspDbzlBasCustom.regSeq,jdbcType=VARCHAR} || '%'
                or a.phe_nbr like '%' || #{hspDbzlBasCustom.regSeq,jdbcType=VARCHAR} || '%'
                or a.id_nbr like '%' || #{hspDbzlBasCustom.regSeq,jdbcType=VARCHAR} || '%')
            </if>

        </if>
    </sql>
    <update id="updateHspDbzlBasByRegSeq" parameterType="activetech.edpc.pojo.dto.HspDbzlBasQueryDto">
        update hsp_dbzl_bas a
        set a.id_nbr         = #{hspDbzlBasCustom.idNbr, jdbcType = VARCHAR},
            a.nation         = #{hspDbzlBasCustom.nation, jdbcType = VARCHAR},
            a.emg_job        = #{hspDbzlBasCustom.emgJob, jdbcType = VARCHAR},
            a.cst_edu        = #{hspDbzlBasCustom.cstEdu, jdbcType = VARCHAR},
            a.marital_status = #{hspDbzlBasCustom.maritalStatus, jdbcType = VARCHAR},
            a.jzxh           = #{hspDbzlBasCustom.jzxh, jdbcType = VARCHAR},
            a.zyxh           = #{hspDbzlBasCustom.zyxh, jdbcType = VARCHAR},
            a.mod_no         = #{hspDbzlBasCustom.modNo, jdbcType = VARCHAR},
            a.mod_tim        = sysdate
        where a.reg_seq = #{hspDbzlBasCustom.regSeq, jdbcType = VARCHAR}
    </update>

    <select id="selectHspDbzlBasPatient" parameterType="activetech.edpc.pojo.dto.HspDbzlBasQueryDto"
            resultType="activetech.edpc.pojo.dto.HspDbzlBasCustom">
        <include refid="activetech.base.CommonSql.page_start"/>
        select
        REG_SEQ,
        REG_TIM,
        EMG_SEQ,
        MPI,
        PAT_TYP,
        WAY_TYP,
        CARD_TYPE,
        VST_CAD,
        CST_NAM,
        CST_SEX_COD,
        ID_TYPE,
        ID_NBR,
        CST_AGE_COD,
        CST_AGE,
        PAT_WGT,
        PAT_HGT,
        BTH_DAT,
        PHE_NBR,
        CST_ADR,
        NATION,
        EMG_JOB,
        MARITAL_STATUS,
        CST_EDU,
        LNK_MAN,
        LNK_WAY,
        GRN_CHL,
        SW_CHL,
        HSP_ARA,
        YQXH,
        JZXH,
        ZYXH,
        DOC_DAT,
        JZYS,
        YSXM,
        KSDM,
        CRT_TIM,
        CRT_NO,
        CRT_NAM,
        MOD_TIM,
        MOD_NO,
        MOD_NAM,
        RCD_STA,
        CHK_TIM,
        CHK_NO,
        CHK_NAM,
        CHK_MSG,
        STP_FLG,
        STP_TIM,
        STP_NO,
        STP_NAM,
        SMT_STA,
        SMT_SEQ,
        SMT_MSG
        FROM hsp_dbzl_bas a
        where
        a.pat_typ = #{patTyp,jdbcType = VARCHAR}
        and
        not exists ( select 1 FROM hsp_fuv_pat where pat_id = a.reg_seq)
        <include refid="condition"/>
        <include refid="activetech.base.CommonSql.page_end"/>
    </select>

    <select id="countByCondition" resultType="java.lang.Integer"
            parameterType="activetech.edpc.pojo.dto.HspDbzlBasQueryDto">
        select count(*)
        from hsp_dbzl_bas a
        where
        a.pat_typ = #{patTyp,jdbcType = VARCHAR}
        and
        not exists ( select 1 FROM hsp_fuv_pat where pat_id = a.reg_seq)
        <include refid="condition"/>
    </select>


     <select id="selectByPrimaryByEmgSeq" resultType="activetech.edpc.pojo.domain.HspDbzlBas"
             parameterType="activetech.edpc.pojo.domain.HspDbzlBas">
        select *
        from hsp_dbzl_bas
        where
        emg_seq = #{emgSeq,jdbcType = VARCHAR}
    </select>

    <select id="selectByEmgSeq" resultType="activetech.edpc.pojo.dto.HspDbzlBasCustom"
            parameterType="java.lang.String">
        select *
        from hsp_dbzl_bas a
        where
          a.reg_seq = #{emgSeq,jdbcType=VARCHAR}
           or a.cst_nam = #{emgSeq,jdbcType=VARCHAR}
           or a.phe_nbr = #{emgSeq,jdbcType=VARCHAR}
           or a.id_nbr = #{emgSeq,jdbcType=VARCHAR}
           or a.emg_seq = #{emgSeq,jdbcType=VARCHAR}
    </select>

    <update id="reviewSubmitBySeqArr">
        update hsp_dbzl_bas set
               rcd_sta = #{hspDbzlBasCustom.rcdSta, jdbcType = VARCHAR },
               chk_tim = #{hspDbzlBasCustom.chkTim, jdbcType = TIMESTAMP },
               chk_no = #{hspDbzlBasCustom.chkNo, jdbcType = VARCHAR },
               chk_nam = #{hspDbzlBasCustom.chkNam, jdbcType = VARCHAR },
               chk_msg = #{hspDbzlBasCustom.chkMsg, jdbcType = VARCHAR },
               mod_tim = sysdate,
               mod_no = #{hspDbzlBasCustom.modNo, jdbcType = VARCHAR },
               mod_nam = #{hspDbzlBasCustom.modNam, jdbcType = VARCHAR }
         where reg_seq in
         <foreach collection="seqArr" item="regSeq" open="(" index="idx" close=")" separator="," >
             #{regSeq, jdbcType = VARCHAR }
         </foreach>
    </update>

    <update id="editDbzlBasByReport">
        update hsp_dbzl_bas set
               smt_sta = #{smtSta, jdbcType = VARCHAR },
               smt_seq = nvl(smt_seq, #{smtSeq, jdbcType = VARCHAR }),
               smt_msg = #{smtMsg, jdbcType = VARCHAR },
               smt_no = #{smtNo, jdbcType = VARCHAR },
               smt_nam = #{smtNam, jdbcType = VARCHAR },
               smt_tim = #{smtTim, jdbcType = TIMESTAMP },
               mod_no = #{modNo, jdbcType = VARCHAR },
               mod_nam = #{modNam, jdbcType = VARCHAR },
               mod_tim = sysdate
         where reg_seq = #{regSeq, jdbcType = VARCHAR }
    </update>

    <!--    <insert id="addNewPatient" parameterType="activetech.edpc.pojo.dto.HspDbzlBasQueryDto">-->
<!--        insert -->
<!--    </insert>-->
</mapper>